{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <h2>Dashboard</h2>
        <ul class="list-group">
            <li class="list-group-item">
                <a hx-get="{% url 'list_orders' %}" hx-target="#content" hx-push-url="true">Orders</a>
            </li>
            <li class="list-group-item">
                <a hx-get="{% url 'list_returns' %}" hx-target="#content" hx-push-url="true">Returns</a>
            </li>
            <li class="list-group-item">
                <a hx-get="{% url 'list_disputes' %}" hx-target="#content" hx-push-url="true">Disputes</a>
            </li>
        </ul>
    </div>
    <div class="col-md-9">
        <div id="content">
            <!-- HTMX will load the dynamic content here -->
        </div>
    </div>

    <!-- Modal placeholder for create/edit -->
    <div id="modal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog " role="document">
            <div class="modal-content">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Modal placeholder for create/edit -->
    <div id="modal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content" id="modalContent">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Toast Container (Bootstrap 5) -->
    <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3">
        <!-- Toast Template (hidden by default) -->
        <div id="toast-template" class="toast align-items-center text-bg-success border-0" role="alert"
            aria-live="assertive" aria-atomic="true" style="display: none;">
            <div class="d-flex">
                <div class="toast-body"></div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
    </div>


    <script>
        const modal = new bootstrap.Modal(document.getElementById("modal"));

        // Show the modal after content is swapped into it
        htmx.on("htmx:afterSwap", (e) => {
            if (e.detail.target.classList.contains("modal-content")) {
                modal.show();
            }
        });

        // Handle success actions after form submission
        htmx.on("htmx:afterRequest", (e) => {
            if (e.detail.xhr.status === 200 && e.detail.target.classList.contains("modal-content")) {
                // modal.hide();
                $('#modal').modal('hide');
                htmx.ajax("GET", "/orders/", "#content", { swap: "outerHTML" });
            }
        });

        // Listen for the custom 'showToast' event to display the toast notification
        htmx.on("showToast", (event) => {
            const toastData = event.detail;

            // Check if toastData contains message and tags
            if (toastData && toastData.message) {
                const template = document.getElementById("toast-template").cloneNode(true);
                template.id = "";  // Remove the ID from the cloned element
                template.style.display = "block";  // Make the toast visible
                template.querySelector(".toast-body").textContent = toastData.message;  // Set the message
                template.classList.add("text-bg-" + toastData.tags);  // Add success, danger, etc., based on tags

                // Append the toast to the container and show it
                document.getElementById("toast-container").appendChild(template);
                const toast = new bootstrap.Toast(template, { delay: 3000 });
                toast.show();
            } else {
                console.error("Toast data is undefined or missing 'message' property.");
            }
        });

    </script>




    <!-- <script>
        const modal = new bootstrap.Modal(document.getElementById("modal"));

        // Show the modal only for specific actions (like Create or Edit)
        htmx.on("htmx:afterSwap", (e) => {
            console.log("After swap event triggered", e.detail.target);
            console.log("HTMX Event Details:", e.detail);

            // Check if requestConfig and requestConfig.url exist before calling includes()
            if (e.detail.requestConfig && e.detail.requestConfig.path &&
                (e.detail.requestConfig.path.includes('create') || e.detail.requestConfig.path.includes('edit'))) {
                console.log("INSIDE CREATE/EDIT MODAL");
                modal.show();  // Trigger modal display
            } else {
                console.log("OUTSIDE CREATE/EDIT MODAL");
            }
        });


        // Hide modal after successful form submission
        htmx.on("htmx:beforeSwap", (e) => {
            console.log("Before swap event triggered", e.detail.target);

            // Ensure the modal is hidden only if the modal is the target and there is no response (e.g., form successfully submitted)
            if (document.querySelector('#modal') && !e.detail.xhr.response) {
                console.log("HIDING MODAL");
                modal.hide();
                e.detail.shouldSwap = false;
            }
        });


    </script> -->

</div>

{% endblock %}